function doUpload(t){var e=new FormData;e.append("data",t),$.ajax({type:"POST",url:"http://tal.mrawde.com/",data:e,processData:!1,enctype:"multipart/form-data",contentType:!1}).done(function(t){window.location="http://tal.mrawde.com/card?"+$("#form-message").serialize()})}(function(){var t;t=function(){function t(t){var e={};this.options=$.extend(e,t),this.init()}return t.prototype.init=function(){var t=this;this.audioContext=new AudioContext,this.audioInput=null,this.realAudioInput=null,this.inputPoint=null,this.audioRecorder=null,this.rafID=null,this.analyserContext=null,this.recIndex=0,this.initAudio(),this.initListeners()},t.prototype.gotBuffers=function(t){var e=$('<li><canvas></canvas><div class="buttons"><button class="play"></button><button class="reset">Try Again</button></div></li>');$("#recordings").empty().append(e);var a=e.find("canvas")[0];drawBuffer(a.width,a.height,a.getContext("2d"),t[0])},t.prototype.gotStream=function(t){var e=this.audioContext.createGain(),a=this.audioContext.createMediaStreamSource(t),n=a;n.connect(e),this.analyserNode=this.audioContext.createAnalyser(),this.analyserNode.fftSize=2048,e.connect(this.analyserNode),this.audioRecorder=new Recorder(e);var i=this.audioContext.createGain();i.gain.value=0,e.connect(i),i.connect(this.audioContext.destination),this.updateAnalysers()},t.prototype.initAudio=function(){var t=this;navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia),navigator.cancelAnimationFrame||(navigator.cancelAnimationFrame=navigator.webkitCancelAnimationFrame||navigator.mozCancelAnimationFrame),navigator.requestAnimationFrame||(navigator.requestAnimationFrame=navigator.webkitRequestAnimationFrame||navigator.mozRequestAnimationFrame),navigator.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}},function(e){t.gotStream(e)},function(t){alert("Error getting audio"),console.log(t)})},t.prototype.initListeners=function(){var t=this;$("#record").on("click",function(e){e.preventDefault();var a=$(this).closest(".record-area");a.toggleClass("active"),a.hasClass("active")?t.recordStart():t.recordStop()}),$("#recordings").on("click",".play",function(e){e.preventDefault(),t.recordingPlay()}),$("#recordings").on("click",".reset",function(t){t.preventDefault(),$("#recordings").empty(),$(".submit").addClass("hide")}),$('input[name="url"]').on("blur",function(){t.lookupURL($(this).val())}),$("#form-message").submit(function(e){return doUpload(t.blob),e.preventDefault(),!1})},t.prototype.lookupURL=function(t){var e="http://tal.mrawde.com/knomad";$.getJSON(e,{link:t},function(t){var e=$('<div class="card"><img src="'+t.showImageUrl+'" /><div class="title">'+t.episodeTitle+"</div></div>");$("#preview").append(e)})},t.prototype.recordingPlay=function(){var t=$("#audio-playback")[0];t.currentTime=0,t.play(),$("#recordings .play").addClass("active"),t.addEventListener("ended",function(){$("#recordings .play").removeClass("active")})},t.prototype.recordStart=function(){this.audioRecorder.clear(),this.audioRecorder.record()},t.prototype.recordStop=function(){var t=this;$(".submit").removeClass("inactive"),this.audioRecorder.stop(),this.audioRecorder.exportWAV(function(e){window.URL=window.URL||window.webkitURL,$("#audio-playback")[0].src=window.URL.createObjectURL(e),t.blob=e,t.audioRecorder.getBuffers(function(e){t.gotBuffers(e)})})},t.prototype.updateAnalysers=function(t){var e=this;if(!this.analyserContext){var a=$("#analyser")[0];this.canvasWidth=a.width,this.canvasHeight=a.height,this.analyserContext=a.getContext("2d")}var n=3,i=1,o=Math.round(this.canvasWidth/n),r=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(r),this.analyserContext.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.analyserContext.fillStyle="#F6D565",this.analyserContext.lineCap="round";for(var s=this.analyserNode.frequencyBinCount/o,c=0;o>c;++c){for(var d=0,l=Math.floor(c*s),u=0;s>u;u++)d+=r[l+u];d/=s;var h=r[c*s];this.analyserContext.fillStyle="hsl( "+Math.round(360*c/o)+", 100%, 50%)",this.analyserContext.fillRect(c*n,this.canvasHeight,i,-d)}this.rafID=window.requestAnimationFrame(function(t){e.updateAnalysers(t)})},t}(),$(function(){return new t({})})}).call(this);